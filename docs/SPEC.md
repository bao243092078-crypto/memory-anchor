# Memory Anchor - 产品规格书

> ⚠️ **已废弃**：本文档基于早期"患者照护"定位，已不再准确。
> 当前定位请参阅：
> - **README.md** - 项目概述
> - **docs/MEMORY_STRATEGY.md** - 五层认知记忆模型
> - **.ai/NORTH_STAR.md** - 北极星愿景
>
> "阿默斯海默症"是**隐喻**——把 AI 当作失忆患者，不是为真实患者设计。

## 一句话定位（⚠️ 已废弃）
~~为认知障碍群体（人类患者 + AI 编程助手）提供"便利贴式"分层记忆管理系统。~~

**当前定位**：为 AI 编程助手（Claude Code / Cursor / Codex）提供跨会话持久化记忆系统。

---

## 范围边界

### 做什么（Scope In）
- 便利贴创建/编辑/删除（照护者端）
- 便利贴展示/主动提醒（患者端）
- 三层记忆存储（宪法/事实/会话）
- 文字转语音播报
- 语义搜索

### 不做什么（Scope Out）
- 医疗诊断/治疗建议
- 脑力训练游戏
- 社交网络功能
- 实时定位追踪（隐私敏感）
- 与医院系统对接（需资质）

---

## 三层记忆模型

### Layer 1: 宪法层（Constitution）

核心身份信息，永不过期。

| 字段 | 类型 | 说明 |
|------|------|------|
| id | uuid | 主键 |
| content | text | 核心身份/规则 |
| priority | int | 0=最高 |
| created_by | text | 照护者ID |
| version | int | 版本号 |
| created_at | timestamp | 创建时间 |

**特征**：
- 写入：仅照护者，需二次确认
- 读取：每次会话开始自动加载
- 冲突：版本号高者优先
- 过期：永不过期，仅显式删除

**示例**：
```json
{"content": "你是王明，今年75岁，住在北京", "priority": 0}
{"content": "你的女儿叫王小红，电话13800138000", "priority": 1}
```

### Layer 2: 事实层（Facts）

长期记忆，可过期可验证。

| 字段 | 类型 | 说明 |
|------|------|------|
| id | uuid | 主键 |
| content | text | 事实内容 |
| category | enum | 人物/地点/事件/物品/日常 |
| embedding | vector(3072) | 语义向量 |
| confidence | float | 置信度 0-1 |
| last_verified | timestamp | 最后验证时间 |
| expires_at | timestamp | 过期时间（可选）|
| is_active | bool | 是否激活 |

**特征**：
- 写入：照护者 + AI 辅助提取
- 读取：语义检索（RAG）
- 冲突：last_verified 新者优先
- 过期：超过 expires_at 标记为待验证

### Layer 3: 会话层（Session）

短期对话，24h 后归档。

| 字段 | 类型 | 说明 |
|------|------|------|
| session_id | uuid | 会话ID |
| turns | jsonb | 对话轮次 |
| summary | text | 会话摘要 |
| promoted_facts | uuid[] | 提升到事实层的ID |
| created_at | timestamp | 创建时间 |

### 层间流动规则

```
会话层 ──[置信度>0.8]──> 事实层 ──[照护者确认]──> 宪法层
                 ↑                        ↓
          [AI 提取]              [自动加载到会话]
```

---

## 验收标准（可测）

| ID | 标准 | 测试方法 |
|----|------|---------|
| AC1 | 照护者可创建便利贴 | API 调用 + DB 验证 |
| AC2 | 便利贴在患者端显示 | 页面截图对比 |
| AC3 | 语音可播报便利贴 | TTS 输出验证 |
| AC4 | 语义搜索召回率>70% | 测试集评估 |
| AC5 | 响应时间<2s | 性能测试 |
| AC6 | 患者端字体>=24px | UI 检查 |

---

## 风险 Top 10

| 排名 | 风险 | 概率 | 影响 | 得分 | 对策 |
|------|------|------|------|------|------|
| 1 | 用户无法操作 | 高 | 高 | 9 | 极简UI + 语音交互 |
| 2 | 隐私泄露 | 中 | 高 | 6 | 本地优先 + 加密 |
| 3 | AI 幻觉导致错误信息 | 高 | 中 | 6 | 人工确认 + 置信度阈值 |
| 4 | 患者排斥使用 | 中 | 高 | 6 | 渐进式引入 + 语音优先 |
| 5 | 语义搜索不准确 | 中 | 中 | 4 | 混合检索（关键词+向量）|
| 6 | 照护者疲劳 | 中 | 中 | 4 | 自动提取 + 批量操作 |
| 7 | 硬件设备不可用 | 中 | 中 | 4 | PWA 跨平台 |
| 8 | 数据同步冲突 | 低 | 高 | 3 | 版本号机制 |
| 9 | 医疗合规风险 | 低 | 高 | 3 | 明确定位为"辅助工具" |
| 10 | 技术栈选择错误 | 低 | 中 | 2 | MVP 验证后再扩展 |

---

## MVP 功能清单（14天）

### P0（必须）
- [ ] 便利贴 CRUD API
- [ ] Qdrant 语义搜索集成
- [ ] 照护者 Web UI（创建/编辑/删除）
- [ ] 患者端展示页（极简大字体）

### P1（应该）
- [ ] TTS 语音播报
- [ ] 定时提醒
- [ ] PWA 配置

### P2（可以）
- [ ] 图片识别创建便利贴
- [ ] 语音输入
- [ ] 多用户支持

### 不做
- 离线同步（需要 CRDT）
- 医疗数据导出（合规风险）
- 与智能家居联动（复杂度高）
