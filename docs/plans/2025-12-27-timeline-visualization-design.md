# Memory Anchor æ—¶é—´çº¿å¯è§†åŒ–è®¾è®¡

> æ—¥æœŸï¼š2025-12-27
> çŠ¶æ€ï¼šâœ… Phase 1 å·²å®Œæˆï¼ˆ2025-12-27ï¼‰

## èƒŒæ™¯

Memory Viewer Web UI ç¼–è¾‘åŠŸèƒ½ï¼ˆPhase 1-4ï¼‰å·²å®Œæˆï¼Œç”¨æˆ·é€‰æ‹©"æ—¶é—´çº¿å¯è§†åŒ–"ä½œä¸ºä¸‹ä¸€ä¸ªåŠŸèƒ½ã€‚

## ç›®æ ‡

- å¯è§†åŒ–å±•ç¤ºè®°å¿†éšæ—¶é—´çš„åˆ†å¸ƒ
- æŒ‰å±‚çº§ï¼ˆL0-L4ï¼‰åŒºåˆ†æ˜¾ç¤º
- æ”¯æŒæ—¶é—´èŒƒå›´ç­›é€‰
- å¸®åŠ©ç”¨æˆ·ç†è§£è®°å¿†ç³»ç»Ÿçš„ä½¿ç”¨æ¨¡å¼

## æŠ€æœ¯é€‰å‹

| é€‰é¡¹ | å¤§å° | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|------|
| **Recharts** âœ… | ~50KB | React åŸç”Ÿã€å£°æ˜å¼ã€ç¤¾åŒºæ´»è·ƒ | åŠŸèƒ½æ¯” ECharts å°‘ |
| Chart.js | ~60KB | è½»é‡ã€canvas æ¸²æŸ“ | éœ€ react-chartjs-2 å°è£… |
| ECharts | ~300KB | åŠŸèƒ½æœ€å…¨ã€ä¸­æ–‡æ”¯æŒå¥½ | ä½“ç§¯å¤§ã€å‘½ä»¤å¼ API |

**é€‰æ‹© Recharts**ï¼šä½“ç§¯å°ã€React åŸç”Ÿã€æ»¡è¶³éœ€æ±‚ã€‚

## æ•°æ®ç»“æ„

### ç°æœ‰å­—æ®µ

```typescript
// backend/models/note.py
created_at: datetime  // è®°å¿†åˆ›å»ºæ—¶é—´
event_when: datetime  // L2 äº‹ä»¶å‘ç”Ÿæ—¶é—´ï¼ˆå¯é€‰ï¼‰
```

### å‰ç«¯èšåˆæ ¼å¼

```typescript
interface TimelineData {
  date: string;  // "2025-12-27"
  L0: number;    // identity_schema æ•°é‡
  L1: number;    // active_context æ•°é‡ï¼ˆé€šå¸¸ä¸º0ï¼‰
  L2: number;    // event_log æ•°é‡
  L3: number;    // verified_fact æ•°é‡
  L4: number;    // operational_knowledge æ•°é‡
  total: number;
}
```

## ç»„ä»¶è®¾è®¡

```
frontend/viewer/src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ timeline/
â”‚   â”‚   â”œâ”€â”€ TimelineChart.tsx      # ä¸»å›¾è¡¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ TimelineFilters.tsx    # æ—¶é—´èŒƒå›´ç­›é€‰å™¨
â”‚   â”‚   â”œâ”€â”€ TimelineTooltip.tsx    # æ‚¬åœæç¤º
â”‚   â”‚   â””â”€â”€ TimelineLegend.tsx     # å›¾ä¾‹ï¼ˆå±‚çº§é¢œè‰²è¯´æ˜ï¼‰
â”‚   â””â”€â”€ ...
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ TimelinePage.tsx           # æ—¶é—´çº¿é¡µé¢
â””â”€â”€ hooks/
    â””â”€â”€ useTimelineData.ts         # æ•°æ®èšåˆ Hook
```

## äº¤äº’è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Memory Anchor                           [æœç´¢] [æ—¶é—´çº¿]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€ æ—¶é—´èŒƒå›´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [æœ€è¿‘7å¤© â–¼]  [è‡ªå®šä¹‰: 2025-12-01 ~ 2025-12-27]       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€ è®°å¿†æ—¶é—´çº¿ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     â–²                                                 â”‚  â”‚
â”‚  â”‚  15 â”‚    â–ˆâ–ˆâ–ˆâ–ˆ                                         â”‚  â”‚
â”‚  â”‚     â”‚    â–ˆâ–ˆâ–ˆâ–ˆ â–“â–“â–“â–“                                    â”‚  â”‚
â”‚  â”‚  10 â”‚    â–ˆâ–ˆâ–ˆâ–ˆ â–“â–“â–“â–“ â–ˆâ–ˆâ–ˆâ–ˆ                              â”‚  â”‚
â”‚  â”‚     â”‚ â–‘â–‘ â–ˆâ–ˆâ–ˆâ–ˆ â–“â–“â–“â–“ â–ˆâ–ˆâ–ˆâ–ˆ â–“â–“â–“â–“                         â”‚  â”‚
â”‚  â”‚   5 â”‚ â–‘â–‘ â–ˆâ–ˆâ–ˆâ–ˆ â–“â–“â–“â–“ â–ˆâ–ˆâ–ˆâ–ˆ â–“â–“â–“â–“ â–ˆâ–ˆâ–ˆâ–ˆ                    â”‚  â”‚
â”‚  â”‚     â”‚ â–‘â–‘ â–ˆâ–ˆâ–ˆâ–ˆ â–“â–“â–“â–“ â–ˆâ–ˆâ–ˆâ–ˆ â–“â–“â–“â–“ â–ˆâ–ˆâ–ˆâ–ˆ â–‘â–‘                 â”‚  â”‚
â”‚  â”‚   0 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶   â”‚  â”‚
â”‚  â”‚       12/21 12/22 12/23 12/24 12/25 12/26 12/27       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€ å›¾ä¾‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ”´ L0 èº«ä»½å›¾å¼  ğŸŸ¢ L2 äº‹ä»¶æ—¥å¿—  ğŸ”µ L3 éªŒè¯äº‹å®        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å®ç°è®¡åˆ’

| é˜¶æ®µ | å†…å®¹ | å·¥ä½œé‡ |
|------|------|--------|
| Phase 1 | MVPï¼šRecharts + åŸºç¡€å›¾è¡¨ | å° |
| Phase 2 | æ—¶é—´ç­›é€‰å™¨ + ç²’åº¦åˆ‡æ¢ | å° |
| Phase 3 | åç«¯æ—¶é—´èŒƒå›´ API | ä¸­ |
| Phase 4 | äº¤äº’å¢å¼ºï¼ˆç‚¹å‡»è·³è½¬ã€åŠ¨ç”»ï¼‰ | å° |

### Phase 1 ä»»åŠ¡ï¼ˆMVPï¼‰âœ…

**å‰ç«¯ï¼š**
- [x] å®‰è£… Rechartsï¼š`npm install recharts`
- [x] åˆ›å»º `useTimelineData.ts` Hookï¼ˆå‰ç«¯èšåˆï¼‰
- [x] åˆ›å»º `TimelineChart.tsx`ï¼ˆå †å é¢ç§¯å›¾ï¼‰
- [x] åˆ›å»º `TimelinePage.tsx` é¡µé¢
- [x] æ·»åŠ è·¯ç”±å’Œå¯¼èˆªå…¥å£ï¼ˆHeader è§†å›¾åˆ‡æ¢ï¼‰

**å›¾è¡¨é…ç½®ï¼š**
- ç±»å‹ï¼šAreaChartï¼ˆå †å é¢ç§¯å›¾ï¼‰
- X è½´ï¼šæ—¥æœŸ
- Y è½´ï¼šè®°å¿†æ•°é‡
- é¢œè‰²ï¼šå¤ç”¨ç°æœ‰å±‚çº§è‰²ï¼ˆL0 çº¢ã€L2 ç»¿ã€L3 è“ï¼‰

### Phase 2 ä»»åŠ¡

- [ ] åˆ›å»º `TimelineFilters.tsx`
- [ ] å®ç°æ—¶é—´èŒƒå›´é€‰æ‹©ï¼ˆæœ€è¿‘7å¤©/30å¤©/è‡ªå®šä¹‰ï¼‰
- [ ] å®ç°ç²’åº¦åˆ‡æ¢ï¼ˆæŒ‰å¤©/æŒ‰å‘¨/æŒ‰æœˆï¼‰
- [ ] ä¼˜åŒ– Tooltip æ˜¾ç¤º

### Phase 3 ä»»åŠ¡ï¼ˆåç«¯ä¼˜åŒ–ï¼‰

- [ ] å®ç° `GET /api/v1/notes/timeline` ç«¯ç‚¹
- [ ] æ”¯æŒæ—¶é—´èŒƒå›´æŸ¥è¯¢å‚æ•°
- [ ] åç«¯èšåˆå‡å°‘æ•°æ®ä¼ è¾“

### Phase 4 ä»»åŠ¡

- [ ] ç‚¹å‡»æ—¥æœŸè·³è½¬åˆ°å½“å¤©è®°å¿†åˆ—è¡¨
- [ ] æ·»åŠ åŠ è½½åŠ¨ç”»
- [ ] ç©ºçŠ¶æ€å¤„ç†

## å±‚çº§é¢œè‰²æ˜ å°„

å¤ç”¨ç°æœ‰è®¾è®¡ç³»ç»Ÿï¼š

```typescript
const LAYER_COLORS = {
  identity_schema: '#EF4444',  // çº¢è‰²
  active_context: '#F59E0B',   // æ©™è‰²ï¼ˆé€šå¸¸ä¸æ˜¾ç¤ºï¼‰
  event_log: '#22C55E',        // ç»¿è‰²
  verified_fact: '#3B82F6',    // è“è‰²
  operational_knowledge: '#6B7280',  // ç°è‰²
};
```

## å†³ç­–è®°å½•

| å†³ç­– | é€‰æ‹© | åŸå›  |
|------|------|------|
| å›¾è¡¨åº“ | Recharts | ä½“ç§¯å°ã€React åŸç”Ÿ |
| å›¾è¡¨ç±»å‹ | å †å é¢ç§¯å›¾ | æ¸…æ™°å±•ç¤ºå±‚çº§åˆ†å¸ƒå’Œè¶‹åŠ¿ |
| æ•°æ®èšåˆ | å‰ç«¯ä¼˜å…ˆ | MVP å¿«é€Ÿå®ç°ï¼Œåç«¯ Phase 3 ä¼˜åŒ– |
| è·¯ç”± | `/timeline` | ç‹¬ç«‹é¡µé¢ï¼Œä¸å¹²æ‰°ç°æœ‰æœç´¢åŠŸèƒ½ |
