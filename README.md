<div align="center">

# Memory Anchor ğŸ§ âš“

### AI çš„å¤–æŒ‚æµ·é©¬ä½“ | The External Hippocampus for AI

[![Version](https://img.shields.io/badge/version-3.0.0-blue?style=for-the-badge)](https://github.com/bao243092078-crypto/memory-anchor/releases)
[![Tests](https://img.shields.io/badge/tests-621%20passed-success?style=for-the-badge)](https://github.com/bao243092078-crypto/memory-anchor)
[![Python](https://img.shields.io/badge/python-3.12-3776AB?style=for-the-badge&logo=python&logoColor=white)](https://www.python.org/)
[![MCP](https://img.shields.io/badge/MCP-14%20tools-8B5CF6?style=for-the-badge)](https://modelcontextprotocol.io/)
[![License](https://img.shields.io/badge/license-MIT-green?style=for-the-badge)](LICENSE)

**è§£å†³ AI çš„"é˜¿å°”èŒ¨æµ·é»˜ç—‡"ï¼šä¸Šä¸‹æ–‡å‹ç¼©å¤±å¿†ã€ä»»åŠ¡é—å¿˜ã€å¹»è§‰è·‘å**

[å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹) Â· [åŠŸèƒ½ç‰¹æ€§](#-åŠŸèƒ½ç‰¹æ€§) Â· [æ¶æ„è®¾è®¡](#-æ¶æ„è®¾è®¡) Â· [Web UI](#-web-ui) Â· [æ–‡æ¡£](docs/)

---

### ğŸ¯ v3.0 äº®ç‚¹

| ğŸ›¡ï¸ å®‰å…¨è¿‡æ»¤ | â° æ—¶é—´æ„ŸçŸ¥ | âš”ï¸ å†²çªæ£€æµ‹ | ğŸ“Š é¢„ç®—ç®¡ç† |
|:---:|:---:|:---:|:---:|
| PII è‡ªåŠ¨è„±æ• | Bi-temporal æŸ¥è¯¢ | è§„åˆ™å¼•æ“æ£€æµ‹ | Token é…é¢æ§åˆ¶ |

</div>

---

## ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦ Memory Anchorï¼Ÿ

> **æ ¸å¿ƒéšå–»**ï¼šæŠŠ AI å½“ä½œé˜¿å°”èŒ¨æµ·é»˜ç—‡æ‚£è€…â€”â€”èƒ½åŠ›å¾ˆå¼ºï¼Œä½†æœ‰"è®°å¿†ç¼ºé™·"ã€‚

ä½¿ç”¨ Claude Codeã€Cursorã€Codex ç­‰ AI å·¥å…·æ—¶ï¼Œä½ æ˜¯å¦é‡åˆ°è¿‡ï¼š

| ç—‡çŠ¶ | è¡¨ç° | Memory Anchor è§£å†³æ–¹æ¡ˆ |
|------|------|----------------------|
| ğŸ§  **ä¸Šä¸‹æ–‡å‹ç¼©å¤±å¿†** | èŠåˆ°ä¸€åŠï¼Œå‹ç¼©åå¿˜äº†å…³é”®å†³ç­– | L0 èº«ä»½å›¾å¼å§‹ç»ˆé¢„åŠ è½½ |
| ğŸ“‹ **ä»»åŠ¡é—å¿˜** | åšç€åšç€å¿˜äº†ä¸»è¦ç›®æ ‡ | æ¸…å•é©å‘½ + è·¨ä¼šè¯æŒä¹… |
| ğŸ‘» **å¹»è§‰è·‘å** | è‡ªå·±ç¼–é€ ä»»åŠ¡ï¼Œè·‘å»åšåˆ«çš„ | åŒ—ææ˜Ÿå¯¹é½ + åç¦»æ£€æµ‹ |
| ğŸ”„ **æ–°ä¼šè¯å¤±å¿†** | æ¯æ¬¡å¼€å§‹éƒ½è¦é‡æ–°è§£é‡Šé¡¹ç›® | è‡ªåŠ¨åŠ è½½é¡¹ç›®ä¸Šä¸‹æ–‡ |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
# ä½¿ç”¨ uvï¼ˆæ¨èï¼‰
uv add memory-anchor

# æˆ– pip
pip install memory-anchor
```

### åˆå§‹åŒ– & å¯åŠ¨

```bash
# 1. åˆå§‹åŒ–é¡¹ç›®
./ma init --project my-project

# 2. å¥åº·æ£€æŸ¥
./ma doctor --project my-project

# 3. é…ç½® Claude Codeï¼ˆæ·»åŠ åˆ° ~/.claude.jsonï¼‰
```

```json
{
  "mcpServers": {
    "memory-anchor": {
      "command": "memory-anchor",
      "args": ["serve", "--project", "my-project"]
    }
  }
}
```

### Qdrantï¼ˆä¸€æ¬¡æ€§å›ºå®šï¼Œé¿å…æ•°æ®â€œä¸¢å¤±â€ï¼‰

- Qdrant å­˜å‚¨å›ºå®šåœ¨ `~/.qdrant_storage`ï¼ˆDocker é»˜è®¤æŒ‚è½½ï¼‰ï¼Œæ•°æ®ä¸éšé¡¹ç›®ç§»åŠ¨
- åªç”¨ Docker æˆ–åªç”¨æœ¬åœ° Qdrantï¼Œä¸è¦æ··ç”¨ï¼ˆé¿å…ä¸¤ä¸ªå®ä¾‹è¯»å†™åŒä¸€ä»½å­˜å‚¨ï¼‰
- Server æ¨¡å¼è¯·è®¾ç½®ï¼š`QDRANT_URL=http://127.0.0.1:6333`
- è·¯å¾„å«é ASCII æ—¶ï¼Œä½¿ç”¨ `-p memory-anchor` æˆ–è®¾ç½® `COMPOSE_PROJECT_NAME=memory-anchor`
- å»ºè®®å›ºå®š `QDRANT_URL` ä¸ `MCP_MEMORY_PROJECT_ID`ï¼Œé¿å…å†™å…¥/æŸ¥è¯¢é”™é¡¹ç›®

```bash
docker compose -p memory-anchor up -d qdrant
export QDRANT_URL=http://127.0.0.1:6333
curl http://127.0.0.1:6333/readyz
```

### äº‘ç«¯åŒæ­¥ï¼ˆå¯é€‰ï¼‰

```bash
# åˆå§‹åŒ– S3/R2/MinIO
./ma cloud init --provider s3 --bucket my-memories

# æ¨é€ï¼ˆAES-256-GCM åŠ å¯†ï¼‰
./ma cloud push --project my-project

# æ‹‰å–
./ma cloud pull --project my-project
```

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### äº”å±‚è®¤çŸ¥è®°å¿†æ¨¡å‹

åŸºäºè®¤çŸ¥ç§‘å­¦è®¾è®¡ï¼Œæ¨¡æ‹Ÿäººç±»è®°å¿†ç³»ç»Ÿï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L0  identity_schema   èº«ä»½å›¾å¼   â–“â–“â–“â–“â–“  å§‹ç»ˆé¢„åŠ è½½ Â· ä¸‰æ¬¡å®¡æ‰¹  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  L1  active_context    å·¥ä½œè®°å¿†   â–‘â–‘â–‘â–‘â–‘  ä¼šè¯ä¸´æ—¶ Â· ä¸æŒä¹…åŒ–    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  L2  event_log         äº‹ä»¶æ—¥å¿—   â–“â–“â–“â–‘â–‘  æ—¶é—´æˆ³ Â· å¯è®¾ TTL     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  L3  verified_fact     éªŒè¯äº‹å®   â–“â–“â–“â–“â–‘  é•¿æœŸå­˜å‚¨ Â· è¯­ä¹‰æ£€ç´¢   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  L4  operational_knowledge æ“ä½œçŸ¥è¯† â–“â–“â–‘â–‘â–‘  SOP Â· è‡ªåŠ¨è§¦å‘      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### MCP å·¥å…·é›†ï¼ˆ14 ä¸ªï¼‰

<table>
<tr>
<td width="50%">

**æ ¸å¿ƒè®°å¿†**
| å·¥å…· | è¯´æ˜ |
|------|------|
| `search_memory` | è¯­ä¹‰æœç´¢ |
| `add_memory` | æ·»åŠ è®°å¿† |
| `get_constitution` | è·å–èº«ä»½ |
| `delete_memory` | åˆ é™¤ï¼ˆéœ€ç¡®è®¤ï¼‰|
| `refine_memory` | LLM å‹ç¼© |

</td>
<td width="50%">

**æ¸…å•é©å‘½**
| å·¥å…· | è¯´æ˜ |
|------|------|
| `create_checklist_item` | åˆ›å»ºæ¸…å• |
| `get_checklist_briefing` | è·å–ç®€æŠ¥ |
| `sync_from_plan` | åŒæ­¥çŠ¶æ€ |

</td>
</tr>
<tr>
<td>

**äº‹ä»¶æ—¥å¿— (L2)**
| å·¥å…· | è¯´æ˜ |
|------|------|
| `log_event` | è®°å½•äº‹ä»¶ |
| `search_events` | æ—¶é—´æœç´¢ |
| `promote_to_fact` | æå‡ä¸º L3 |

</td>
<td>

**æ“ä½œçŸ¥è¯† (L4)**
| å·¥å…· | è¯´æ˜ |
|------|------|
| `search_operations` | æœç´¢ SOP |
| `propose_constitution_change` | ä¿®æ”¹èº«ä»½ |

</td>
</tr>
</table>

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### v3.0 è®¤çŸ¥å¢å¼ºï¼ˆæ–°ï¼‰

| åŠŸèƒ½ | è¯´æ˜ | CLI å‘½ä»¤ |
|------|------|----------|
| **ContextBudgetManager** | Token é¢„ç®—ç®¡ç†ï¼Œé˜²æ­¢ä¸Šä¸‹æ–‡çˆ†ç‚¸ | `./ma budget` |
| **SafetyFilter** | PII æ£€æµ‹ + æ•æ„Ÿè¯è¿‡æ»¤ | è‡ªåŠ¨å¯ç”¨ |
| **Bi-temporal æ—¶é—´æ„ŸçŸ¥** | `valid_at`/`expires_at` æ—¶é—´ç»´åº¦æŸ¥è¯¢ | MCP: `as_of` å‚æ•° |
| **ConflictDetector** | è§„åˆ™å¼•æ“å†²çªæ£€æµ‹ï¼ˆæ—¶é—´/æ¥æº/ç½®ä¿¡åº¦ï¼‰ | `./ma conflicts` |

```python
# Bi-temporal æŸ¥è¯¢ç¤ºä¾‹
search_memory(query="æ‚£è€…ç”¨è¯", as_of="2025-01-01T00:00:00Z")

# å†²çªæ£€æµ‹è‡ªåŠ¨è¿”å›è­¦å‘Š
add_memory("æ–°è®°å¿†") â†’ {"conflict_warning": {...}}
```

### Hook ç³»ç»Ÿï¼ˆ8 ä¸ª Phaseï¼‰

```
SessionStart â”€â”€â–º PreToolUse â”€â”€â–º PostToolUse â”€â”€â–º PreCompact â”€â”€â–º Stop
     â”‚               â”‚              â”‚               â”‚           â”‚
     â–¼               â–¼              â–¼               â–¼           â–¼
  åŠ è½½ä¸Šä¸‹æ–‡     Gatingæ£€æµ‹     æµ‹è¯•å»ºè®®      Checkpoint    ä¼šè¯æ‘˜è¦
```

| Phase | åŠŸèƒ½ | è¯´æ˜ |
|-------|------|------|
| 1 | Hook æ¡†æ¶ | HookType + BaseHook + Registry |
| 2 | çŠ¶æ€ç®¡ç† | StateManager + SessionState |
| 3 | ä¼šè¯æ‘˜è¦ | Stop Hook è‡ªåŠ¨ç”Ÿæˆ |
| 4 | é˜ˆå€¼é…ç½® | 7 ä¸ª MA_* ç¯å¢ƒå˜é‡ |
| 5 | æµ‹è¯•å»ºè®® | PostToolUse + TestMapping |
| 6 | ç¯¡æ”¹æ£€æµ‹ | 5 ç§æµ‹è¯•ä¿®æ”¹æ¨¡å¼ |
| 7 | ä»£ç å®¡æŸ¥ | `./ma review` å››è§†è§’å¹¶è¡Œ |
| 8 | ä¸Šä¸‹æ–‡ä¿æŠ¤ | PRE_COMPACT checkpoint |

### äº‘ç«¯åŒæ­¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    AES-256-GCM    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Local      â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  S3/R2/MinIO â”‚
â”‚  Qdrant     â”‚    JSONL Export   â”‚  Encrypted   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **åŠ å¯†**: AES-256-GCMï¼ˆé›¶çŸ¥è¯†ï¼‰
- **æ ¼å¼**: JSONLï¼ˆå¯è¯»ã€å¯ diffï¼‰
- **ç­–ç•¥**: LWWï¼ˆLast Write Winsï¼‰

---

## ğŸ–¥ï¸ Web UI

ç°ä»£ SaaS é£æ ¼çš„è®°å¿†ç®¡ç†ç•Œé¢ï¼š

### åŠŸèƒ½

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| ğŸ” **è¯­ä¹‰æœç´¢** | å‘é‡ç›¸ä¼¼åº¦æ£€ç´¢ |
| ğŸ·ï¸ **å±‚çº§ç­›é€‰** | L0-L4 è¿‡æ»¤ |
| ğŸ“‚ **åˆ†ç±»ç­›é€‰** | äººç‰©/åœ°ç‚¹/äº‹ä»¶/ç‰©å“/ä¹ æƒ¯ |
| âœ… **æ‰¹é‡æ“ä½œ** | å¤šé€‰åˆ é™¤/éªŒè¯ |
| ğŸ“Š **æ—¶é—´çº¿** | Recharts å †å é¢ç§¯å›¾ |
| ğŸ•¸ï¸ **è®°å¿†å›¾è°±** | D3.js åŠ›å¯¼å‘å›¾ï¼ˆèŠ‚ç‚¹ç‚¹å‡»/ç¼©æ”¾/ç­›é€‰ï¼‰|
| ğŸŒ **å¤šè¯­è¨€** | ä¸­è‹±æ–‡åˆ‡æ¢ï¼ˆ160+ keysï¼‰|
| ğŸ“ **å¤šé¡¹ç›®** | ProjectSelector éš”ç¦» |

### å¯åŠ¨

```bash
cd frontend/viewer
npm install && npm run dev
# â†’ http://localhost:5173
```

---

## ğŸ“Š æŠ€æœ¯æ ˆ

<table>
<tr>
<td width="50%">

**åç«¯**
- Python 3.12 + FastAPI
- Qdrantï¼ˆå‘é‡æ•°æ®åº“ï¼‰
- FastEmbedï¼ˆåµŒå…¥æ¨¡å‹ï¼‰
- Typer + Richï¼ˆCLIï¼‰

</td>
<td width="50%">

**å‰ç«¯**
- React 18 + TypeScript
- Vite + Tailwind CSS
- D3.jsï¼ˆè®°å¿†å›¾è°±ï¼‰
- Rechartsï¼ˆæ—¶é—´çº¿ï¼‰
- i18nextï¼ˆå›½é™…åŒ–ï¼‰

</td>
</tr>
</table>

---

## ğŸ“– æ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ |
|------|------|
| [CLAUDE.md](CLAUDE.md) | AI å¼€å‘æŒ‡å— |
| [docs/MEMORY_STRATEGY.md](docs/MEMORY_STRATEGY.md) | è®°å¿†ç­–ç•¥è¯¦è§£ |
| [.ai/NORTH_STAR.md](.ai/NORTH_STAR.md) | é¡¹ç›®åŒ—ææ˜Ÿ |
| [.ai/PLAN.md](.ai/PLAN.md) | å½“å‰è®¡åˆ’ |

---

## ğŸ—ºï¸ è·¯çº¿å›¾

### v3.0.0 âœ… æœ€æ–° - è®¤çŸ¥å¢å¼ºç‰ˆ

- [x] **ContextBudgetManager** - Token é¢„ç®—ç®¡ç†ï¼Œé˜²æ­¢ä¸Šä¸‹æ–‡çˆ†ç‚¸
- [x] **SafetyFilter** - PII æ£€æµ‹ + æ•æ„Ÿè¯è¿‡æ»¤ï¼ˆblock/redact/warnï¼‰
- [x] **Bi-temporal æ—¶é—´æ„ŸçŸ¥** - `valid_at`/`expires_at` æ—¶é—´ç»´åº¦æŸ¥è¯¢
- [x] **ConflictDetector MVP** - è§„åˆ™å¼•æ“å†²çªæ£€æµ‹ï¼ˆæ—¶é—´/æ¥æº/ç½®ä¿¡åº¦ï¼‰
- [x] 621 ä¸ªæµ‹è¯•é€šè¿‡

### v2.1.0 âœ…

- [x] è®°å¿†å›¾è°±å¯è§†åŒ–ï¼ˆD3.js åŠ›å¯¼å‘å›¾ï¼‰
- [x] èŠ‚ç‚¹äº¤äº’ï¼šç‚¹å‡»è¯¦æƒ…ã€ç¼©æ”¾ã€æ‹–æ‹½ã€å¹³ç§»
- [x] Graph APIï¼š`/api/v1/graph` ç«¯ç‚¹
- [x] 498 ä¸ªæµ‹è¯•é€šè¿‡

### v2.0.0 âœ…

- [x] äº”å±‚è®¤çŸ¥è®°å¿†æ¨¡å‹ï¼ˆL0-L4ï¼‰
- [x] 14 ä¸ª MCP å·¥å…·
- [x] Hook ç³»ç»Ÿï¼ˆ8 ä¸ª Phaseï¼‰
- [x] äº‘ç«¯åŒæ­¥ï¼ˆS3/R2/MinIO + AES-256-GCMï¼‰
- [x] Web UIï¼ˆæœç´¢/ç­›é€‰/æ—¶é—´çº¿/æ‰¹é‡/i18nï¼‰

### æœªæ¥æ–¹å‘ ğŸ”®

- [ ] VSCode / Cursor æ’ä»¶
- [ ] å›¢é˜Ÿåä½œï¼ˆå¤šç”¨æˆ·ï¼‰
- [ ] ç§»åŠ¨ç«¯ PWA

---

## ğŸ¤ è´¡çŒ®

```bash
# å…‹éš†
git clone https://github.com/bao243092078-crypto/memory-anchor.git

# å®‰è£…
uv sync --all-extras

# æµ‹è¯•
uv run pytest

# ä»£ç æ£€æŸ¥
uv run ruff check backend && uv run mypy backend
```

---

## ğŸ“œ è®¸å¯è¯

[MIT License](LICENSE)

---

<div align="center">

### ğŸ’¡ æ ¸å¿ƒæ´è§

**AI çš„"é˜¿å°”èŒ¨æµ·é»˜ç—‡"ä¸æ˜¯ bugï¼Œæ˜¯ feature çš„ç¼ºå¤±ã€‚**

Memory Anchor ä¸æ˜¯æ²»æ„ˆ AIï¼Œè€Œæ˜¯ç»™å®ƒä¸€ä¸ª**å¤–æŒ‚çš„æµ·é©¬ä½“**ã€‚

---

Made with â¤ï¸ by [baobao](https://github.com/bao243092078-crypto)

**[â¬† å›åˆ°é¡¶éƒ¨](#memory-anchor-)**

</div>
